using UnityEngine;

using LibNoise;
using LibNoise.Generator;
using LibNoise.Operator;

public class Noise : MonoBehaviour
{
    // Specify the size of the noise map to generate.
    public int mapSizeX = 256;
    public int mapSizeY = 256;

    // Perlin sample size
    public double sampleSizeX = 8.0;
    public double sampleSizeY = 8.0;

    // Add size to the offset
    public double sampleOffsetX = 5.0;
    public double sampleOffsetY = 6.0;

    // Parametrs for modification Perlin function
    public int octaves = 10;
    public double frequency = 1.4;
    public double persistance = 0.7;

    // This class helps us to render the texture
    public Renderer planeRenderer;

    // This class helps us to keep new texture
    private Texture2D texture;

    // Is called before any of the Update
    private void Start()
    {
        Generate();
    }

    // Is called every frame (60 frames per second)
    void Update()
    {
        if (Input.GetMouseButtonDown(0))
            Generate();
    }

    private void Generate()
    {
        // Instantiate Perlin noise module
        var myPerlin = new Perlin();

        myPerlin.OctaveCount = octaves;
        myPerlin.Frequency = frequency;
        myPerlin.Persistence = persistance;

        // Set this module into base class for noise modules
        ModuleBase myModule = myPerlin;

        
        // Generate a heightmap (two-dimensional array)
        // It stores coherent-noise values generated by a noise module
        var heightMap = new Noise2D(mapSizeX, mapSizeY, myModule);


        // Generates a non-seamless planar projection of the noise map.
        heightMap.GeneratePlanar(
            sampleOffsetX,
            sampleOffsetX + sampleSizeX,
            sampleOffsetY,
            sampleOffsetY + sampleSizeY
            );

        // Get the generated texture
        texture = heightMap.GetTexture(GradientPresets.RGB);

        // Set the render material texture of a plane
        // (Mesh Renderer component -> Materials -> Texture)
        planeRenderer.material.mainTexture = texture;
    }


}
